# Valheim Telegram Notify

Valheim Telegram Notify — это простой скрипт на bash, который проверяет log-файл сервера Valheim и отправляет уведомления в телеграм-чат, если находит нужные строки. Он создан для простоты использования и должен работать на большинстве дистрибутивов Linux.

## Поддерживаемые уведомления
Скрипт распознает 8 событий, которые можно извлечь из журнала консоли сервера:
1. Игрок присоединяется к серверу
2. Игрок отключается от сервера
3. Игрок (пере)рождается
4. Игрок погибает
5. Все онлайн игроки засыпают ночью, и начинается новый день (сервер пропускает оставшееся время ночи)
6. Срабатывает случайное событие, см. https://valheim.fandom.com/wiki/Events 
7. Запуск сервера и загрузка мира
8. Отключение сервера

## Предварительные требования для Telegram
Вам нужно создать телеграм-бота, добавить его в чат и получить ID этого чата.
- Создайте телеграм-бота, следуя [этим инструкциям](https://core.telegram.org/bots#6-botfather) и скопируйте API-токен
- Добавьте бота в чат в Telegram
- В браузере откройте страницу ``https://api.telegram.org/bot<API-token>/getUpdates`` и запомните ID чата

## Установка и настройка
- Разместите скрипты vh-notify.sh и userlist.txt на вашем сервере
- В скрипте vh-notify.sh настройте следующие значения:
  - CHATID: ID телеграм-чата, куда будут отправляться уведомления
  - KEY: API-токен вашего телеграм-бота
  - LOGFILE: расположение файла журнала консоли сервера Valheim
- Убедитесь, что vh-notify.sh исполняемый, например, выполните ``chmod +x vh-notify.sh``
- ~~Добавьте 64-битные Steam ID с соответствующими именами пользователей в usernames.txt~~ Больше не требуется, скрипт попытается найти ID и имена пользователей. Однако, если вы хотите, вы можете изменить имена или добавить ID и имена, сам скрипт не перезапишет существующие данные в этом файле.
- Запустите скрипт командой ``./vh-notify.sh &``
- Для автоматического запуска при загрузке системы добавьте в cron с помощью ``crontab -e`` и затем добавьте строку (замените на фактическое расположение скрипта) ``@reboot /home/vhserver/valheim-notify/vh-notify.sh &``

## Имена пользователей Steam
Сообщения о подключении и отключении в журнале сервера упоминают 64-битный Steam ID игрока, подключающегося к серверу. Скрипт попытается найти этот Steam ID и сохранит ID вместе с именем пользователя в usernames.txt. Если скрипт не найдет соответствующий Steam ID в usernames.txt, он сообщит ``Неизвестно (Steam ID)`` в уведомлении.
Сообщения о смерти и (пере)рождении в журнале упоминают имя персонажа Valheim, с которым игрок вошел в мир, поэтому скрипт непосредственно парсит их из журнала.
